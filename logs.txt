root@ams-1-vm-cd6u:~/NanoBananaBot# docker-compose logs -f
Attaching to telegram_bot_app, telegram_bot_worker, telegram_bot_db, telegram_bot_redis
telegram_bot_app | Waiting for database...
telegram_bot_app | Running migrations...
telegram_bot_app | INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
telegram_bot_app | INFO  [alembic.runtime.migration] Will assume transactional DDL.
telegram_bot_app | Starting FastAPI server...
telegram_bot_app | INFO:     Started server process [11]
telegram_bot_app | INFO:     Waiting for application startup.
telegram_bot_app | 2025-12-25 22:31:01,316 - bot.main - INFO - Starting application...
telegram_bot_app | 2025-12-25 22:31:01,429 - bot.main - INFO - Database initialized
telegram_bot_app | 2025-12-25 22:31:01,444 - bot.bot - INFO - Bot instance created
telegram_bot_app | 2025-12-25 22:31:01,444 - bot.bot - INFO - Dispatcher created with MemoryStorage
telegram_bot_app | 2025-12-25 22:31:01,445 - bot.main - INFO - Handlers registered
telegram_bot_app | 2025-12-25 22:31:01,606 - bot.main - INFO - Webhook set to: https://nkonshin7.ru/webhook
telegram_bot_app | INFO:     Application startup complete.
telegram_bot_app | INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
telegram_bot_redis | 1:C 25 Dec 2025 22:30:40.258 # WARNING Memory overcommit must be enabled! Without it, a background save or replication may fail under low memory condition. Being disabled, it can also cause failures without low memory condition, see https://github.com/jemalloc/jemalloc/issues/1328. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.
telegram_bot_redis | 1:C 25 Dec 2025 22:30:40.259 * oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
telegram_bot_redis | 1:C 25 Dec 2025 22:30:40.259 * Redis version=7.4.7, bits=64, commit=00000000, modified=0, pid=1, just started
telegram_bot_redis | 1:C 25 Dec 2025 22:30:40.259 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf
telegram_bot_redis | 1:M 25 Dec 2025 22:30:40.259 * Increased maximum number of open files to 10032 (it was originally set to 1024).
telegram_bot_redis | 1:M 25 Dec 2025 22:30:40.259 * monotonic clock: POSIX clock_gettime
telegram_bot_redis | 1:M 25 Dec 2025 22:30:40.263 * Running mode=standalone, port=6379.
telegram_bot_redis | 1:M 25 Dec 2025 22:30:40.264 * Server initialized
telegram_bot_redis | 1:M 25 Dec 2025 22:30:40.266 * Loading RDB produced by version 7.4.7
telegram_bot_redis | 1:M 25 Dec 2025 22:30:40.266 * RDB age 159 seconds
telegram_bot_redis | 1:M 25 Dec 2025 22:30:40.266 * RDB memory usage when created 1.61 Mb
telegram_bot_redis | 1:M 25 Dec 2025 22:30:40.267 * Done loading RDB, keys loaded: 5, keys expired: 1.
telegram_bot_redis | 1:M 25 Dec 2025 22:30:40.267 * DB loaded from disk: 0.002 seconds
telegram_bot_redis | 1:M 25 Dec 2025 22:30:40.267 * Ready to accept connections tcp
telegram_bot_worker | 2025-12-25 22:30:51,666 - __main__ - INFO - Connected to Redis at redis://redis:6379/0
telegram_bot_worker | 2025-12-25 22:30:51,667 - __main__ - INFO - Listening on queue: default
telegram_bot_worker | 2025-12-25 22:30:51,676 - __main__ - INFO - Starting RQ worker...
telegram_bot_worker | 2025-12-25 22:30:51,676 - rq.worker - INFO - Worker 09e73efb54154f95bb13e4665ca28fdd: started with PID 1, version 2.6.1
telegram_bot_worker | 2025-12-25 22:30:51,677 - rq.worker - INFO - Worker 09e73efb54154f95bb13e4665ca28fdd: subscribing to channel rq:pubsub:09e73efb54154f95bb13e4665ca28fdd
telegram_bot_worker | 2025-12-25 22:30:51,678 - rq.worker - INFO - *** Listening on default...
telegram_bot_worker | 2025-12-25 22:30:51,679 - rq.worker - INFO - Worker 09e73efb54154f95bb13e4665ca28fdd: cleaning registries for queue: default
telegram_bot_db | 
telegram_bot_db | PostgreSQL Database directory appears to contain a database; Skipping initialization
telegram_bot_db | 
telegram_bot_db | 2025-12-25 22:30:40.413 UTC [1] LOG:  starting PostgreSQL 15.15 on x86_64-pc-linux-musl, compiled by gcc (Alpine 15.2.0) 15.2.0, 64-bit
telegram_bot_db | 2025-12-25 22:30:40.413 UTC [1] LOG:  listening on IPv4 address "0.0.0.0", port 5432
telegram_bot_db | 2025-12-25 22:30:40.413 UTC [1] LOG:  listening on IPv6 address "::", port 5432
telegram_bot_db | 2025-12-25 22:30:40.416 UTC [1] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
telegram_bot_db | 2025-12-25 22:30:40.428 UTC [27] LOG:  database system was shut down at 2025-12-25 22:28:01 UTC
telegram_bot_db | 2025-12-25 22:30:40.457 UTC [1] LOG:  database system is ready to accept connections
telegram_bot_db | 2025-12-25 22:30:50.343 UTC [37] FATAL:  database "botuser" does not exist
telegram_bot_db | 2025-12-25 22:31:00.446 UTC [45] FATAL:  database "botuser" does not exist
telegram_bot_db | 2025-12-25 22:31:10.505 UTC [54] FATAL:  database "botuser" does not exist
Exception in thread Thread-5 (watch_events):
Traceback (most recent call last):
  File "/usr/lib/python3.12/threading.py", line 1073, in _bootstrap_inner
    self.run()
  File "/usr/lib/python3.12/threading.py", line 1010, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/lib/python3/dist-packages/compose/cli/log_printer.py", line 202, in watch_events
    for event in event_stream:
  File "/usr/lib/python3/dist-packages/compose/project.py", line 626, in yield_loop
    yield build_container_event(event)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3/dist-packages/compose/project.py", line 594, in build_container_event
    container = Container.from_id(self.client, event['id'])
                                               ~~~~~^^^^^^
KeyError: 'id'
telegram_bot_db | 2025-12-25 22:31:20.557 UTC [61] FATAL:  database "botuser" does not exist
telegram_bot_app | INFO:     172.18.0.1:58300 - "POST /webhook HTTP/1.0" 200 OK
telegram_bot_app | 2025-12-25 22:31:28,292 - aiogram.event - INFO - Update id=707992012 is handled. Duration 239 ms by bot id=8381024334
telegram_bot_db | 2025-12-25 22:31:30.614 UTC [68] FATAL:  database "botuser" does not exist
telegram_bot_app | INFO:     172.18.0.1:54996 - "POST /webhook HTTP/1.0" 200 OK
telegram_bot_app | 2025-12-25 22:31:39,802 - aiogram.event - INFO - Update id=707992013 is handled. Duration 123 ms by bot id=8381024334
telegram_bot_db | 2025-12-25 22:31:40.673 UTC [75] FATAL:  database "botuser" does not exist
telegram_bot_app | INFO:     172.18.0.1:34916 - "POST /webhook HTTP/1.0" 200 OK
telegram_bot_app | 2025-12-25 22:31:41,436 - aiogram.event - INFO - Update id=707992014 is handled. Duration 136 ms by bot id=8381024334
telegram_bot_app | 2025-12-25 22:31:49,369 - aiogram.event - INFO - Update id=707992015 is handled. Duration 72 ms by bot id=8381024334
telegram_bot_app | INFO:     172.18.0.1:34920 - "POST /webhook HTTP/1.0" 200 OK
telegram_bot_db | 2025-12-25 22:31:50.733 UTC [82] FATAL:  database "botuser" does not exist
telegram_bot_app | 2025-12-25 22:31:51,207 - bot.handlers.generate - INFO - Created generation task 4 for user 2
telegram_bot_app | 2025-12-25 22:31:51,284 - bot.tasks.generation - INFO - Enqueued task 4 as job 87926102-eeb1-4225-8120-b194d5b2cc2a
telegram_bot_worker | 2025-12-25 22:31:51,292 - rq.worker - INFO - default: bot.tasks.generation.process_generation_task(4) (87926102-eeb1-4225-8120-b194d5b2cc2a)
telegram_bot_app | INFO:     172.18.0.1:42528 - "POST /webhook HTTP/1.0" 200 OK
telegram_bot_app | 2025-12-25 22:31:51,410 - aiogram.event - INFO - Update id=707992016 is handled. Duration 223 ms by bot id=8381024334
telegram_bot_worker | 2025-12-25 22:31:52,216 - bot.tasks.generation - INFO - Processing generation task 4
telegram_bot_worker | 2025-12-25 22:31:52,387 - bot.tasks.generation - INFO - Task 4 status updated to processing
telegram_bot_worker | 2025-12-25 22:31:52,427 - bot.services.image_provider - INFO - Generating image with model gpt-image-1, prompt: Создай изображение города Пермь в России, центр города, зима, все красиво украшено...
telegram_bot_db | 2025-12-25 22:32:00.844 UTC [91] FATAL:  database "botuser" does not exist
telegram_bot_db | 2025-12-25 22:32:10.895 UTC [97] FATAL:  database "botuser" does not exist
telegram_bot_db | 2025-12-25 22:32:20.944 UTC [105] FATAL:  database "botuser" does not exist
telegram_bot_app | INFO:     172.18.0.1:34294 - "GET /.env HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:34302 - "GET /marketing/.env.staging HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:34316 - "GET /environments/test/.env HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:34320 - "GET /aws/konfig/aws_auth.php HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:34322 - "GET /administration/.env.dev HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:34328 - "GET /.env.test.localapi/.env HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:34336 - "GET /config/env/mandrill.env HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:54092 - "GET /app/config/.env.staging HTTP/1.0" 404 Not Found
telegram_bot_db | 2025-12-25 22:32:30.998 UTC [112] FATAL:  database "botuser" does not exist
telegram_bot_app | INFO:     172.18.0.1:54098 - "GET /config/.env.credentials HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:54100 - "GET /application/.env.sample HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:54102 - "GET /config/development/.env HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:54112 - "GET /?redirect=/var/www/.env HTTP/1.0" 200 OK
telegram_bot_app | INFO:     172.18.0.1:54120 - "GET /config/aws_settings.php HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:54132 - "GET /?uri=/var/www/html/.env HTTP/1.0" 200 OK
telegram_bot_app | INFO:     172.18.0.1:54144 - "GET /config/env/sendgrid.env HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:54150 - "GET /config/environment/.env HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:54156 - "GET /backend/.env.production HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:54158 - "GET /config/.env.development HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:54174 - "GET /konfig/aws_settings.php HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:54180 - "GET /?target=/home/user/.env HTTP/1.0" 200 OK
telegram_bot_app | INFO:     172.18.0.1:54196 - "GET /current/.env.production HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:54212 - "GET /dashboard/.env.disabled HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:54226 - "GET /dashboard/.env.settings HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:54236 - "GET /legacy/tests/9.1.1/.env HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:54238 - "GET /develop/.env.production HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:54244 - "GET /legacy/tests/9.2.0/.env HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:54246 - "GET /laravel/core/.env.local HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:54254 - "GET /src/main/resources/.env HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:36008 - "GET /staging/.env.production HTTP/1.0" 404 Not Found
telegram_bot_db | 2025-12-25 22:32:41.054 UTC [120] FATAL:  database "botuser" does not exist
telegram_bot_app | INFO:     172.18.0.1:36022 - "GET /private/.env.production HTTP/1.0" 404 Not Found
telegram_bot_app | INFO:     172.18.0.1:36036 - "GET /secrets/aws/session.yml HTTP/1.0" 404 Not Found
telegram_bot_worker | 2025-12-25 22:32:43,273 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/images/generations "HTTP/1.1 200 OK"
telegram_bot_worker | 2025-12-25 22:32:43,794 - bot.services.image_provider - INFO - Image generated successfully: None
telegram_bot_worker | 2025-12-25 22:32:43,795 - bot.tasks.generation - WARNING - Task 4 generation failed: Unknown error
telegram_bot_worker | 2025-12-25 22:32:43,795 - bot.tasks.generation - ERROR - Task 4 failed with error: Unknown error
telegram_bot_worker | 2025-12-25 22:32:43,810 - bot.tasks.generation - INFO - Task 4 retry 1/3, re-queuing...
telegram_bot_worker | 2025-12-25 22:32:43,817 - rq.worker - ERROR - Worker 09e73efb54154f95bb13e4665ca28fdd: job 87926102-eeb1-4225-8120-b194d5b2cc2a: exception raised while executing (bot.tasks.generation.process_generation_task)
telegram_bot_worker | Traceback (most recent call last):
telegram_bot_worker |   File "/usr/local/lib/python3.11/site-packages/rq/worker.py", line 1439, in perform_job
telegram_bot_worker |     return_value = job.perform()
telegram_bot_worker |                    ^^^^^^^^^^^^^
telegram_bot_worker |   File "/usr/local/lib/python3.11/site-packages/rq/job.py", line 1318, in perform
telegram_bot_worker |     self._result = self._execute()
telegram_bot_worker |                    ^^^^^^^^^^^^^^^
telegram_bot_worker |   File "/usr/local/lib/python3.11/site-packages/rq/job.py", line 1376, in _execute
telegram_bot_worker |     result = self.func(*self.args, **self.kwargs)
telegram_bot_worker |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
telegram_bot_worker |   File "/app/bot/tasks/generation.py", line 79, in process_generation_task
telegram_bot_worker |     return asyncio.get_event_loop().run_until_complete(
telegram_bot_worker |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
telegram_bot_worker |   File "/usr/local/lib/python3.11/asyncio/base_events.py", line 654, in run_until_complete
telegram_bot_worker |     return future.result()
telegram_bot_worker |            ^^^^^^^^^^^^^^^
telegram_bot_worker |   File "/app/bot/tasks/generation.py", line 158, in _process_generation_task_async
telegram_bot_worker |     raise GenerationError(error_msg)
telegram_bot_worker | bot.tasks.generation.GenerationError: Unknown error
telegram_bot_worker | 
telegram_bot_worker | 2025-12-25 22:32:43,822 - rq.job - INFO - Job 87926102-eeb1-4225-8120-b194d5b2cc2a: scheduled for retry at 2025-12-25 22:32:53.819745+00:00, 2 remaining